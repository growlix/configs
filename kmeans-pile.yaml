run_name: kmeans-pile
platform: r7z2
gpu_type: a100_40gb
gpu_num: 8
image: growlix/data-dedupe
command: |
  cd streaming

  git pull

  aws s3 cp s3://mosaicml-internal-checkpoints-shared/matthew/embeddings/pile_train_e5base_embeddings.npy /tmp/EMB_ARRAY.npy

  python scripts/deduplication/approximate/kmeans.py --data_path /tmp/EMB_ARRAY.npy  --n_samples 210607728 --dim 768 --filename_base pile_train --n_centroids 50000

  aws s3 cp /tmp/centroids/pile_train_clusters.pkl s3://mosaicml-internal-checkpoints-shared/matthew/kmeans/pile_train_clusters.pkl
