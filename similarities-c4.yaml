run_name: similarities-c4
platform: r7z2
gpu_type: a100_40gb
gpu_num: 8
image: growlix/data-dedupe
command: |
  cd streaming

  git pull

  aws s3 cp s3://mosaicml-internal-checkpoints-shared/matthew/embeddings/c4_train_e5base_embeddings.npy /tmp/c4_train_embeddings.npy
  
  aws s3 cp  s3://mosaicml-internal-checkpoints-shared/matthew/kmeans/c4_train_clusters.pkl /tmp/c4_train_clusters.pkl

  python scripts/deduplication/approximate/pairwise_sim.py --emb_path /tmp/c4_train_embeddings.npy --centroid_path /tmp/c4_train_clusters.pkl --n_samples 364868892 --dim 768 --filename_base c4_train

  aws s3 cp /tmp/similarities/c4_train_max_similarity.pkl s3://mosaicml-internal-checkpoints-shared/matthew/similarities/c4_train_max_similarity.pkl
